<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Wirepas Single-MCU SDK: Configuration of a node</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Wirepas Single-MCU SDK"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../small_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Wirepas Single-MCU SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d1/d59/configuration_of_a_node.html','../../');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Configuration of a node </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <a class="el" href="../../dc/dc0/app_init.html">App_Init()</a> function is the entry point for the application. It is called by the stack after each boot.</p>
<p>The Wirepas Connectivity stack is in the stopped state during this call. All the API calls that require the stack to be in the stopped state, like configuring node settings, must be done in this function.</p>
<p>The code below shows the minimal steps for an application to configure a node and start the stack.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> App_init(<span class="keyword">const</span> <a class="code" href="../../d2/d39/app_8h.html#d6/d81/structapp__global__functions__t">app_global_functions_t</a> * functions)</div><div class="line">{</div><div class="line">    <span class="comment">// Basic configuration of the node with a unique node address</span></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="../../df/d2e/node__configuration_8h.html#a1814777eb4e2f9906b0bed022de9e966">configureNode</a>(<a class="code" href="../../df/d2e/node__configuration_8h.html#a445f5127c4f9e8f7e3ffd4694fedaf30">getUniqueAddress</a>(),</div><div class="line">                      NETWORK_ADDRESS,</div><div class="line">                      NETWORK_CHANNEL) != <a class="code" href="../../d2/d39/app_8h.html#a4d380466f2a9f6432a6abcabf44c8e80a003dcdf43ec0474fb1190cdccd959122">APP_RES_OK</a>)</div><div class="line">    {</div><div class="line">        <span class="comment">// Could not configure the node. It should not happen</span></div><div class="line">        <span class="comment">// except if one of the config value is invalid</span></div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    ...</div><div class="line"></div><div class="line">    lib_state-&gt;startStack();</div><div class="line">}</div></div><!-- fragment --><p>A newly flashed device starts with its role set to <a class="el" href="../../de/d60/settings_8h.html#ab42b1333ea2649dfc695dfc0423f1184a45e9c1d12ed69997903750fd96b3a2e9">APP_LIB_SETTINGS_ROLE_HEADNODE</a> and with the flag <a class="el" href="../../de/d60/settings_8h.html#ad60f684ddb64fff64bd9443bec7d6575a62621bb39a97dae23f07fb98fbec0acb">APP_LIB_SETTINGS_ROLE_FLAG_AUTOROLE</a>, by default.</p>
<p>To be able to join a network, the application must set at least a unique node address, a common network address and a common network channel. Consequently, it is important to check if a node setting (role, node address, etc.) is already set before updating it from application initialization code. Otherwise it would break the Remote API, as the remotely updated value would be overwritten in <a class="el" href="../../dc/dc0/app_init.html">App_Init()</a>.</p>
<p>This is the role of the <a class="el" href="../../df/d2e/node__configuration_8h.html#a1814777eb4e2f9906b0bed022de9e966">configureNode()</a> function. It sets the node address, network address and network channel, but <b>ONLY</b> if these settings are missing from the node. This is the case on first boot after flashing but not after any reboots after that, unless the settings are explicitly cleared by the application.</p>
<p>Note that the <a class="el" href="../../db/d3b/state_8h.html#a39ad217d32c2986151820eb24c74e618">lib_state-&gt;stopStack()</a> function will cause a reboot of the device and the <a class="el" href="../../dc/dc0/app_init.html">App_Init()</a> function will be called again.</p>
<p>Once the node is correctly configured, the stack must be started.</p>
<p>This initialization is just an example and can be something different, depending on the use case. For example, the application can wait for configuration via another interface (<a class="el" href="../../d5/d47/source_makefile_hal_uart.html">UART</a>, <a class="el" href="../../dc/d35/source_makefile_hal_spi.html">SPI</a>, NFC, ...). This is the case with the <code><a class="el" href="../../da/d1e/dualmcu_app_2app_8c-example.html">dualmcu_app</a></code> application, for example.</p>
<dl class="section note"><dt>Note</dt><dd>Application <b>must</b> call <a class="el" href="../../db/d3b/state_8h.html#a8b9ddf8d4323784f6a437060c30f31b1">lib_state-&gt;startStack()</a>. It can be at the end of <a class="el" href="../../dc/dc0/app_init.html">App_Init()</a> function or in a <a class="el" href="../../dc/db2/system_8h.html#a3bbe9181ed7a154eb9d2baf96f337701">deferred context</a> but it must be called! Without this call, the node will not be part of any network.</dd>
<dd>
Remote API built-in feature of the stack (described in <a class="el" href="../../d1/d7a/dedicated_area.html#relmat7">[7]</a>) allows the change of a setting remotely. This change can happen any time from the application point of view and will generate a reboot and a new call to <a class="el" href="../../dc/dc0/app_init.html">App_Init()</a> after the update.</dd>
<dd>
Some node settings must be the same across all the nodes in the network. More general information about node configuration can be found in <a class="el" href="../../de/d31/peripherals_available_for_the_application2.html#relmat4">[4]</a>. </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../de/d7a/how_to_develop.html">How to Develop Application with SDK</a></li><li class="navelem"><a class="el" href="../../d4/d87/development_of_a_new_application.html">Create new application</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
