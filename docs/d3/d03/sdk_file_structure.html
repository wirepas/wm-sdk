<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Wirepas Single-MCU SDK: SDK file structure</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Wirepas Single-MCU SDK"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../small_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Wirepas Single-MCU SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d3/d03/sdk_file_structure.html','../../');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">SDK file structure </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page describes the file structure of the SDK. Here, you can find the purpose of directories and files.</p>
<h1><a class="anchor" id="api_folder"></a>
api/ Libraries offered by stack</h1>
<p>The Wirepas Mesh stack (hereafter referred to as the <em>stack</em>) runs on ARM Cortex M based microcontrollers. Hence, the stack and the application both follow the Procedure Call Standard for the ARM Architecture. The stack and the application communicate with each other by calling functions on each other.</p>
<p>The protocol stack is in control of program execution. Application can request to be called periodically, or when certain events happen. Applications can also directly access hardware peripherals that are not used by the stack. Applications can have interrupt handlers, but the service routines must be kept short so they do not interfere with the timing of the Wirepas Mesh protocol.</p>
<p>To keep features in logically separate units, stack functions are collected into <em>libraries</em>. The application opens each library it needs and calls functions in the library via function pointers. A global list of functions is given to the application when it is first called, so that it can open libraries and find out details about the environment in which it is running.</p>
<p>The following table contains following information on libraries:</p><ul>
<li>Name of the library</li>
<li>Library handle set by <a class="el" href="../../dc/d65/api_8h.html#abea8e1483d9fe0c251a2027a34422031">API_Open()</a> function. Application can use this handle to access the services.</li>
<li>Short description of the library</li>
</ul>
<table class="doxtable">
<tr>
<th>Header file</th><th>Handle</th><th>Description </th></tr>
<tr>
<td><a class="el" href="../../d8/d4b/advertiser_8h.html">advertiser.h</a></td><td><a class="el" href="../../d8/d4b/advertiser_8h.html#dd/d07/structapp__lib__advertiser__t">lib_advertiser</a> </td><td>Application library for direct advertiser functionality </td></tr>
<tr>
<td><a class="el" href="../../d2/d39/app_8h.html">app.h</a></td><td>NA</td><td>The global macros, types and functions available to applications can be found in the app.h header </td></tr>
<tr>
<td><a class="el" href="../../d6/d37/beacon__rx_8h.html">beacon_rx.h</a></td><td><a class="el" href="../../d6/d37/beacon__rx_8h.html#da/dd5/structapp__lib__beacon__rx__t">lib_beacon_rx</a> </td><td>Application library for Bluetooth LE beacon RX </td></tr>
<tr>
<td><a class="el" href="../../d4/d48/beacon__tx_8h.html">beacon_tx.h</a></td><td><a class="el" href="../../d4/d48/beacon__tx_8h.html#d2/d19/structapp__lib__beacon__tx__t">lib_beacon_tx</a> </td><td>Transmission of Bluetooth LE compatible beacons </td></tr>
<tr>
<td><a class="el" href="../../d2/dbd/data_8h.html">data.h</a></td><td><a class="el" href="../../d2/dbd/data_8h.html#d0/d3a/structapp__lib__data__t">lib_data</a></td><td>Sending and receiving data packets </td></tr>
<tr>
<td><a class="el" href="../../d7/de1/hardware_8h.html">hardware.h</a></td><td><a class="el" href="../../d7/de1/hardware_8h.html#d0/d0c/structapp__lib__hardware__t">lib_hw</a></td><td>Sharing of hardware peripherals between stack and application </td></tr>
<tr>
<td><a class="el" href="../../df/d08/memory__area_8h.html">memory_area.h</a></td><td><a class="el" href="../../df/d08/memory__area_8h.html#d8/d55/structapp__lib__memory__area__t">lib_memory_area</a> </td><td>Access to non-volatile memory areas </td></tr>
<tr>
<td><a class="el" href="../../db/de4/otap_8h.html">otap.h</a></td><td><a class="el" href="../../db/de4/otap_8h.html#da/d23/structapp__lib__otap__t">lib_otap</a></td><td>The Over-The-Air-Programming (OTAP) library </td></tr>
<tr>
<td><a class="el" href="../../d8/d23/radio__fem_8h.html">radio_fem.h</a></td><td><a class="el" href="../../d8/d23/radio__fem_8h.html#d1/d41/structapp__lib__radio__fem__t">lib_radio_fem</a> </td><td>Application library for radio power and front end module control </td></tr>
<tr>
<td><a class="el" href="../../de/d60/settings_8h.html">settings.h</a></td><td><a class="el" href="../../de/d60/settings_8h.html#de/d5b/structapp__lib__settings__t">lib_settings</a></td><td>Access to node settings, which are stored in nonvolatile memory </td></tr>
<tr>
<td><a class="el" href="../../d9/d81/sleep_8h.html">sleep.h</a></td><td><a class="el" href="../../d9/d81/sleep_8h.html#d1/d14/structapp__lib__sleep__t">lib_sleep</a></td><td>Sleep Wirepas Mesh stack for time periods </td></tr>
<tr>
<td><a class="el" href="../../db/d3b/state_8h.html">state.h</a></td><td><a class="el" href="../../db/d3b/state_8h.html#d6/d1c/structapp__lib__state__t">lib_state</a></td><td>Viewing and controlling stack runtime state </td></tr>
<tr>
<td><a class="el" href="../../d8/d6b/storage_8h.html">storage.h</a></td><td><a class="el" href="../../d8/d6b/storage_8h.html#d3/d48/structapp__lib__storage__t">lib_storage</a></td><td>Small Non-volatile storage area to use for application </td></tr>
<tr>
<td><a class="el" href="../../dc/db2/system_8h.html">system.h</a></td><td><a class="el" href="../../dc/db2/system_8h.html#d3/dd6/structapp__lib__system__t">lib_system</a></td><td>Low-level functions such as application scheduling, interrupt handling, critical sections and power management </td></tr>
<tr>
<td><a class="el" href="../../db/df4/bootloader__test_2tests_2test_8h.html">test.h</a></td><td><a class="el" href="../../dd/db0/api_2test_8h.html#d6/d83/structapp__lib__test__t">lib_test</a></td><td>Library for radio testing services </td></tr>
<tr>
<td><a class="el" href="../../de/df7/time_8h.html">time.h</a></td><td><a class="el" href="../../de/df7/time_8h.html#da/dda/structapp__lib__time__t">lib_time</a></td><td>Keeping track of time and comparing timestamps </td></tr>
</table>
<p><b>NOTE</b>: Not all of the services are available in every platform!</p>
<h2><a class="anchor" id="application_and_library_versioning"></a>
Application and Library Versioning</h2>
<p>To keep features in logically separate units and allow each unit to be updated in a <em>backward- and forward-compatible</em> manner, stack functions are collected into <em>libraries</em>. When an application requests a specific version of a library and no exact version is found, the stack can do one of three things:</p>
<ol type="1">
<li><em>Return a newer, compatible library</em>: This works if the newer library version has new features that have been added in such a way that the old API still works as expected. This is ideally the way new firmware releases add features to the libraries.</li>
<li><em>Emulate the old library</em>: If the new firmware has the library, but it has an incompatible API and application calls <code><a class="el" href="../../d2/d39/app_8h.html#a761f554ee93df6cd5de6f4eeffc29ff7">openLibrary()</a></code> with an old version number. Then, stack returns an emulated version of the old library, which just calls functions in the new library.</li>
<li><em>Fail to open the library</em>: Old, obsoleted features can be phased out by simply failing to open a library that is too old. Stack firmware release notes will list the obsoleted libraries for each release. Then, the associated library handle will be NULL.</li>
</ol>
<p>In addition of library versioning, applications also have an API version number, <a class="el" href="../../d2/d39/app_8h.html#ae1281d6221015da53b2be122f44abea1">APP_API_VERSION</a>, placed in their header. The SDK places the version number there to indicate which version of the low-level application API the application supports. If there is a mismatch between the low-level API versions of the stack and the application, the stack may choose to not run the application.</p>
<h1><a class="anchor" id="board_folder"></a>
board/ Board definitions</h1>
<p>This folder contains definitions for various boards. Board approach allows executing same application in different radio boards. Mainly, board definition define GPIO pins for various purposes, such as serial port pins, leds and buttons.</p>
<p>Each subdirectory name defines the name of the board used in the build process (see <a class="el" href="../../d3/d03/sdk_file_structure.html#app_target_boards">here</a> for how to enable application to use specific board).</p>
<p>Especially, there are two <em>template</em> boards that contain the documentation of the board definitions, according to processor architecture:</p>
<table class="doxtable">
<tr>
<th>Processor architecture</th><th>File</th><th><p class="starttd">File description</p>
<p class="endtd"></p>
</th></tr>
<tr>
<td>EFR32</td><td><a class="el" href="../../d9/df8/efr32__template_2board_8h.html">board/efr32_template/board.h</a></td><td><p class="starttd">Board definition</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>EFR32</td><td><a class="el" href="../../d4/d72/board_2efr32__template_2config_8mk.html">board/efr32_template/config.mk</a></td><td><p class="starttd">Board Configuration</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>EFR32</td><td><a class="el" href="../../d1/de1/board_2efr32_template_2bootloader_2early_init_efr32_8c-example.html">board/efr32_template/bootloader/early_init_efr32.c</a> </td><td><p class="starttd">Board DCDC configuration</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>nRF52</td><td><a class="el" href="../../db/d6b/nrf52__template_2board_8h.html">board/nrf52_template/board.h</a></td><td><p class="starttd">Board definition</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>nRF52</td><td><a class="el" href="../../df/d30/board_2nrf52__template_2config_8mk.html">board/nrf52_template/config.mk</a></td><td>Board Configuration </td></tr>
</table>
<h2><a class="anchor" id="DCDC_converter"></a>
DCDC converter configuration</h2>
<p>DCDC converter configuration is very important topic, especially if low energy consumption is desired. In following table, the configuration is summarized for all processor architectures.</p>
<table class="doxtable">
<tr>
<th>Processor architecture</th><th>DCDC enabled</th><th><p class="starttd">DCDC disabled</p>
<p class="endtd"></p>
</th></tr>
<tr>
<td>EFR32</td><td>Leave following code line commented in <code> early_init_efr32.c</code>: <div class="fragment"><div class="line"><span class="comment">//#define MCU_NO_DCDC</span></div></div><!-- fragment --> </td><td><p class="starttd">Uncomment the line in <code>early_init_efr32.c</code> </p><div class="fragment"><div class="line"><span class="preprocessor">#define MCU_NO_DCDC</span></div></div><!-- fragment --> <p class="endtd"></p>
</td></tr>
<tr>
<td>nRF52</td><td>Uncomment line in <code>board.h</code>: <div class="fragment"><div class="line"><span class="comment">// The board supports DCDC</span></div><div class="line"><span class="preprocessor">#define BOARD_SUPPORT_DCDC</span></div></div><!-- fragment --> </td><td><p class="starttd">Comment line in <code>board.h</code>: </p><div class="fragment"><div class="line"><span class="comment">// The board supports DCDC</span></div><div class="line"><span class="comment">//#define BOARD_SUPPORT_DCDC</span></div></div><!-- fragment --> <p class="endtd"></p>
</td></tr>
</table>
<h1><a class="anchor" id="bootloader_folder"></a>
bootloader/ Bootloader configuration</h1>
<p>This folder contains configuration mechanisms for bootloader operations. By default, they are weak symbols implementing stub functions. THey can be overridden in the application, if desired.</p>
<p>Following files are present:</p>
<table class="doxtable">
<tr>
<th>Name</th><th>Description </th></tr>
<tr>
<td><a class="el" href="../../d6/d3e/early__init_8h.html">early_init.h</a> </td><td>Hooks called early during boot process </td></tr>
<tr>
<td><a class="el" href="../../d3/d53/external__flash_8h.html">external_flash.h</a> </td><td>External flash operation </td></tr>
</table>
<h1><a class="anchor" id="debug_folder"></a>
debug/ Debug printing</h1>
<p>This folder contains implementation of debugs.</p>
<h1><a class="anchor" id="doc_folder"></a>
doc/ Doxygen documentation</h1>
<p>This folder contains files for generating doxygen documentation not present in source codes itself, such as this page.</p>
<h1><a class="anchor" id="image_folder"></a>
image/ Firmware images folder</h1>
<p>This folder contains Wirepas firmware images. Originally folder does not contain any images but when you have <a class="el" href="../../de/d7a/how_to_develop.html#licensing">licensed</a> Wirepas Mesh, you will get an access to firmware images which should be unpacked here.</p>
<h1><a class="anchor" id="libraries_folder"></a>
libraries/ SDK Internal API</h1>
<p>There are numerous services that are given as a source code as part of the SDK. They are for various purposes, like easier access for low level hardware (HAL) routines. They are only present in the generated binaries if they are used.</p>
<p>First group of services is Wirepas wrapper services. They are abstractions of single mcu api to ease the implementation. They are located in <a class="el" href="../../dir_bc0718b08fb2015b8e59c47b2805f60c.html">libraries</a> folder.</p>
<p>Following table, summarize these services and files by:</p><ul>
<li>Name and path of the header file</li>
<li>Short description</li>
</ul>
<table class="doxtable">
<tr>
<th>Name</th><th>Description </th></tr>
<tr>
<td><a class="el" href="../../dd/ddc/app__scheduler_8h.html">app_scheduler.h</a></td><td>Scheduling of multiple application tasks </td></tr>
<tr>
<td><a class="el" href="../../d4/dfa/shared__libdata_8h.html">shared_libdata.h</a></td><td>Handling of data packets </td></tr>
<tr>
<td><a class="el" href="../../d9/d2a/uart__print_8h.html">uart_print.h</a></td><td>UART print module  </td></tr>
<tr>
<td><a class="el" href="../../d0/dae/provisioning_8h.html">provisioning/provisioning.h</a> </td><td>Provisioning </td></tr>
</table>
<h1><a class="anchor" id="makefile"></a>
makefile</h1>
<p>The makefile is used to build an application and produce images to be flashed or used with OTAP mechanism.</p>
<p>All built files for a given app and target_board are stored under <code>build/&lt;target_board&gt;/&lt;app_name&gt;</code>:</p>
<ul>
<li><code>final_image_&lt;app_name&gt;.hex</code>: this image can be flashed on a blank chip. It contains everything (Bootloader, Wirepas Mesh Stack and the application).</li>
<li><code>&lt;app_name&gt;.otap</code>: this image contains only the application and can be used to update the application with the OTAP mechanism.</li>
<li><code>&lt;app_name&gt;_wc_stack.otap</code>: this image contains the application and the Wirepas Mesh stack and can be used to update the application and the stack at the same time with the OTAP mechanism.</li>
</ul>
<h1><a class="anchor" id="mcu_folder"></a>
mcu/ Low level hardware services (HAL)</h1>
<p>This folder contain hardware-specific services.</p>
<h2><a class="anchor" id="mcu_common"></a>
mcu/common Common MCU files</h2>
<p>This folder contains common files for all hardware platforms.</p>
<h3><a class="anchor" id="mcu_common_start_c"></a>
start.c</h3>
<p>This file is present in all applications. It positions the application entry point at the correct place in memory and do basic initialization: it loads the initialized data from flash to RAM, sets the bss area to 0 in RAM, and calls the application initialization function defined in <code>app.c</code>.</p>
<p>It also manages compatibility with the stack to avoid issues when running an application built for an old stack to a newer stack. Running an application built with a SDK newer than the stack version is not allowed.</p>
<h2><a class="anchor" id="mcu_hal_api"></a>
mcu/hal_api Low level hardware API</h2>
<p>Second group of services is low level (HAL) hardware services. They contain the implementations of various hardware peripherals for various hardware platforms and boards.</p>
<p>Relevant services are located in <a class="el" href="../../dir_6cf55800a80cb7b7dd1fbbea9cea607d.html">mcu/hal_api</a> folder. Services are following:</p>
<dl class="section note"><dt>Note</dt><dd>Not all of the services are available in every platform!</dd></dl>
<table class="doxtable">
<tr>
<th>Name (related to mcu/hal_api folder)</th><th>Description </th></tr>
<tr>
<td><a class="el" href="../../d7/d0e/button_8h.html">button.h</a></td><td>Button functions </td></tr>
<tr>
<td><a class="el" href="../../d4/d8d/ds_8h.html">ds.h</a></td><td>Deep sleep control module </td></tr>
<tr>
<td><a class="el" href="../../d9/db1/fem__driver_8h.html">fem_driver.h</a></td><td>Radio FEM (front-end module)  </td></tr>
<tr>
<td><a class="el" href="../../d1/da4/hal__api_8h.html">hal_api.h</a></td><td>Initialization of HAL services  </td></tr>
<tr>
<td><a class="el" href="../../d2/d4c/hw__delay_8h.html">hw_delay.h</a></td><td>Hardware delay module </td></tr>
<tr>
<td><a class="el" href="../../d5/daf/i2c_8h.html">i2c.h</a></td><td>Simple minimal I2C master driver </td></tr>
<tr>
<td><a class="el" href="../../db/da0/led_8h.html">led.h</a></td><td>LED functions </td></tr>
<tr>
<td><a class="el" href="../../de/de8/persistent_8h.html">persistent.h</a></td><td>Hardware-specific persistant memory area </td></tr>
<tr>
<td><a class="el" href="../../d3/d6a/power_8h.html">power.h</a></td><td>Enabling of DCDC converter </td></tr>
<tr>
<td><a class="el" href="../../da/d87/spi_8h.html">spi.h</a></td><td>Simple minimal SPI master driver </td></tr>
<tr>
<td><a class="el" href="../../d3/dfa/mcu_2hal__api_2usart_8h.html">usart.h</a></td><td>USART block handling  </td></tr>
</table>
<h2><a class="anchor" id="mcu_specific_files"></a>
mcu/&lt;hardware&gt;</h2>
<p><a class="el" href="../../dir_4cee3ed2fe28b98d73407141cfd215dc.html">These folders</a> contain mcu specific files to ease and factorize application development. Header files (<code>.h</code>) from this folder can be included in applications directly.</p>
<h2><a class="anchor" id="linker_file"></a>
Linker file</h2>
<p>Linker files are located in <code>mcu/&lt;processor&gt;/linker</code> folder. Linker file is linker script. It ensures that the application is loadable in its dedicated area in Flash. Particularly, it sets the application entry point at the beginning of the area.</p>
<dl class="section note"><dt>Note</dt><dd>Linker files named <code>gcc_bl_*.ld</code> are for bootloader and they should never be modified!</dd></dl>
<h3><a class="anchor" id="flash_memory"></a>
Flash Memory</h3>
<p>To be correctly detected by the Wirepas Mesh stack, the entry point of the application code must be position at address <code>0x40000</code> (256KB after the beginning of flash). This is valid for all hardware profiles.</p>
<p>As described with more details in WP-RM-108 - OTAP Reference Manual, the application shares its flash memory area with the scratchpad area. There is no strict limit for the size of the application but if the application is too big, it will prevent the OTAP to store its scratchpad in the remaining free space.</p>
<p>The recommended maximum size for an application is 40kB.</p>
<p>Example: </p><div class="fragment"><div class="line">MEMORY</div><div class="line">{</div><div class="line">  FLASH (rx)      : ORIGIN = 0x00040000, LENGTH = 40K</div><div class="line">  ...</div><div class="line">}</div></div><!-- fragment --><h3><a class="anchor" id="ram_memory"></a>
RAM memory</h3>
<p>RAM memory is configured in linker file. Value is fixed and should not be modified.</p>
<h1><a class="anchor" id="project_folder"></a>
projects/ Doxygen files</h1>
<p>This folder contains necessary files to recreate this documentation.</p>
<h1><a class="anchor" id="source_folder"></a>
source/ Application examples</h1>
<p>This folder contains applications.</p>
<p>Applications exist in subfolders, named after application name. Note that not all applications exist for every processor architecture.</p>
<p>Applications are categorized into two categories:</p><ul>
<li><a class="el" href="../../d3/d03/sdk_file_structure.html#example_applications">Example applications</a> which can be used as a template for own application development. They are simple applications targeted to specific use case.</li>
<li><a class="el" href="../../d3/d03/sdk_file_structure.html#production_apps">Demos and production apps</a>. They are applications that are dedicated to specific purpose. Compared to example applications, they are relatively complex and mainly to be used as such.</li>
</ul>
<p><a class="anchor" id="example_applications"></a> Example applications are following:</p>
<table class="doxtable">
<tr>
<th>Application name</th><th>Description</th><th><p class="starttd">Notes</p>
<p class="endtd"></p>
</th></tr>
<tr>
<td><a class="el" href="../../d0/d5e/aes_example_2app_8c-example.html">aes_example</a> </td><td>Test software AES library</td><td><p class="starttd"></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><a class="el" href="../../d4/d65/app_debug_2app_8c-example.html">app_debug</a> </td><td>Using debug prints</td><td><p class="starttd"></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><a class="el" href="../../dc/dfe/appconfig_app_2app_8c-example.html">appconfig_app</a> </td><td>Receiving application configuration</td><td><p class="starttd"></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><a class="el" href="../../d1/dac/basic_interrupt_2app_8c-example.html">basic_interrupt</a> </td><td>How to use interrupt service</td><td><p class="starttd">Only Nordic nRF52xx</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><a class="el" href="../../dc/d0e/ble_app_2app_8c-example.html">ble_app</a></td><td>How to receive BLE beacons </td><td><p class="starttd">Only 2.4GHz devices</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><a class="el" href="../../de/dc5/ble_beacon_2app_8c-example.html">ble_beacon</a> </td><td>How to transmit BLE beacons</td><td><p class="starttd">Only 2.4GHz devices</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><a class="el" href="../../d3/d9c/blink_2app_8c-example.html">blink</a> </td><td>Very simple blink/hello world application</td><td><p class="starttd"></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><a class="el" href="../../db/d1b/bme280_example_2app_8c-example.html">bme280_example</a> </td><td>How to use <a href="https://www.bosch-sensortec.com/bst/products/all_products/bme280">Bosch Sensortec BME280 environmental sensor</a>  </td><td><p class="starttd">Only Ruuvitag</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><a class="el" href="../../db/d83/custom_app_2app_8c-example.html">custom_app</a> </td><td>Simple data transmission and reception</td><td><p class="starttd"></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><a class="el" href="../../df/dbb/diradv_example_2app_8c-example.html">diradv_example</a> </td><td>How to use directed advertiser- functionality</td><td><p class="starttd"></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><a class="el" href="../../df/d91/inventory_app_router_2app_8c-example.html">inventory_app_router</a> </td><td>Inventory application using directed-advertiser for headnodes </td><td><p class="starttd"></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><a class="el" href="../../d3/d2f/inventory_app_tag_2app_8c-example.html">inventory_app_tag</a> </td><td>Inventory application using directed-advertiser for advertisers </td><td><p class="starttd"></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><a class="el" href="../../d7/db8/minimal_app_2app_8c-example.html">minimal_app</a> </td><td>Minimal app that just starts the stack</td><td><p class="starttd"></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><a class="el" href="../../d0/d36/nfc_2app_8c-example.html">nfc</a> </td><td>NFC peripheral usage</td><td><p class="starttd">Only Nordic nRF52xx</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><a class="el" href="../../d5/da9/provisioning_joining_node_2app_8c-example.html">provisioning_joining_node</a> </td><td>Using provisioning for a joining node</td><td><p class="starttd"></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>provisioning_proxy_node </td><td>Using provisioning for a proxy node</td><td><p class="starttd"></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><a class="el" href="../../d3/d31/pwm_driver_2app_8c-example.html">pwm_driver</a></td><td>Create PWM signal </td><td><p class="starttd">Only Nordic nRF52xx</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><a class="el" href="../../d5/dc2/scheduler_example_2app_8c-example.html">scheduler_example</a> </td><td>How to use <a class="el" href="../../dd/ddc/app__scheduler_8h.html">Application scheduler</a></td><td><p class="starttd"></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><a class="el" href="../../d1/d47/shared_libdata_example_2app_8c-example.html">shared_libdata_example</a> </td><td>How to use <a class="el" href="../../d4/dfa/shared__libdata_8h.html">shared_libdata.h</a></td><td><p class="starttd"></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><a class="el" href="../../d7/de5/test_app_2app_8c-example.html">test_app</a> </td><td>using <a class="el" href="../../dd/db0/api_2test_8h.html">test library</a> services</td><td><p class="starttd"></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><a class="el" href="../../d8/d5d/tinycbor_example_2app_8c-example.html">tinycbor_example</a> </td><td>use of the tiny cbor library</td><td><p class="starttd"></p>
<p class="endtd"></p>
</td></tr>
</table>
<p><a class="anchor" id="production_apps"></a> Demos and production apps are following:</p>
<table class="doxtable">
<tr>
<th>Application name</th><th>Description</th><th><p class="starttd">Notes</p>
<p class="endtd"></p>
</th></tr>
<tr>
<td><a class="el" href="../../da/d1e/dualmcu_app_2app_8c-example.html">dualmcu_app</a> </td><td>Implementation of dual-MCU API interface, used most commonly in sinks </td><td><p class="starttd"></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><a class="el" href="../../d2/d7a/positioning_app_2app_8c-example.html">positioning_app</a> </td><td>Application to acquire network data for the positioning use case </td><td><p class="starttd">Only Nordic nRF52xx</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><a class="el" href="../../da/d90/ruuvi_evk_2app_8c-example.html">ruuvi_evk</a> </td><td>Send sensor data to backend, control how to send, used in evaluation kits  </td><td><p class="starttd">Only Ruuvitag</p>
<p class="endtd"></p>
</td></tr>
</table>
<h2><a class="anchor" id="source_app_c"></a>
app.c</h2>
<p>This file is present in all applications. Application init function and its application callback functions should be implemented here as defined in the <code>app.h</code> file.</p>
<h2><a class="anchor" id="source_config_mk"></a>
config.mk</h2>
<p><code>config.mk</code> file is used to configure application compilation. Here, the contents of that file have been described. Only fields that are common to all applications are described here! Some applications may have own, application-specific fields which are out of the scope of this documentation. For example, content of the file could be following:</p>
<div class="fragment"><div class="line"><span class="preprocessor"># Define a specific application area_id</span></div><div class="line">app_specific_area_id=0x8CEC79</div><div class="line"></div><div class="line"><span class="preprocessor"># App version</span></div><div class="line">app_major=1</div><div class="line">app_minor=0</div><div class="line">app_maintenance=0</div><div class="line">app_development=0</div></div><!-- fragment --><h3><a class="anchor" id="app_specific_area_id"></a>
app_specific_area_id</h3>
<p>Wirepas network supports <em>Over The Air</em> (OTAP) updates of devices on the network.</p>
<p>A network can contain heterogenous devices (different types of sensors, for example), so various different kinds of applications can coexist simultaneously in a network.</p>
<p>Even when upgrading a subset of nodes in the network (just nodes with a specific type of sensor, for example), all nodes will receive the update image. This is to ensure that all nodes on the network receive the update image, due to the multi-hop nature of the network. Consequently, it is crucial for a node to know if the received image, called a <em>scratchpad</em>, contains any updates for the node in question. This is the purpose of the application area ID.</p>
<p>More information about <em>Over The Air Protocol</em> can be found in <a class="el" href="../../de/d7a/how_to_develop.html#relmat1">[1]</a>.</p>
<p>Each new application <b>must</b> define its own <code>app_specific_area_id</code> in its <code>config.mk</code> file. It is a random 24-bit field that must have its most significant bit set to 1 (MSB to 0 is reserved for Wirepas):</p>
<div class="fragment"><div class="line"><span class="preprocessor"># Define a specific application area_id</span></div><div class="line"><span class="preprocessor">app_specific_area_id=0x83744C</span></div></div><!-- fragment --><p>This specific area ID will be used in two different places:</p>
<ul>
<li>The <em>bootloader</em>, which contains a list of area IDs that it accepts, when a new scratchpad is processed. All the nodes that will be flashed with the image generated from an application build (containing the bootloader) will <em>only</em> accept updates of the application matching the specific area ID defined in <code>config.mk</code>.</li>
<li>In the <em>scratchpad generation tool</em> (genscratchpad.py), where it identifies the application scratchpad image. All the <code>*.otap</code> images generated from this application build will be only accepted by nodes flashed with a bootloader matching this area ID.</li>
</ul>
<p>The <code>app_specific_area_id</code> is only part of the scratchpad area id existing on the device. The whole scratchpad area id is composed on 4 bytes, as following:</p>
<table class="doxtable">
<tr>
<th>byte #</th><th>content </th></tr>
<tr>
<td>MSB byte 0</td><td>app_specific_area_id MSB byte 0 </td></tr>
<tr>
<td>byte 1</td><td>app_specific area id byte 1 </td></tr>
<tr>
<td>byte 2</td><td>app_specific area id LSB byte 2 </td></tr>
<tr>
<td>byte 3 LSB </td><td>hardware magic (see <a class="el" href="../../dc/db2/system_8h.html#a055fd8a1c1565c12af35cd82010b2594">app_lib_system_hardware_magic_e</a>) </td></tr>
</table>
<p>For example, if <code>app_specific_area_id</code> has value of <code>0x83744C </code> and used hardware is Nordic nRF52 (i.e. <a class="el" href="../../dc/db2/system_8h.html#a055fd8a1c1565c12af35cd82010b2594">app_lib_system_hardware_magic_e</a> is <a class="el" href="../../dc/db2/system_8h.html#a055fd8a1c1565c12af35cd82010b2594a39125b2444d95b8c2d25f414acc01a54">APP_LIB_SYSTEM_HARDWARE_MAGIC_NRF52832_SP_2</a>), the resulted area id stored in the devices is: </p><div class="fragment"><div class="line">(0x83744C &lt;&lt; 8) | 3 = 0x83744C03</div></div><!-- fragment --><p>To summarize, in order to have unique scratchpad image on the device, the image must have*</p><ul>
<li>Unique <code>app_specific_area_id</code> OR</li>
<li>Unique processor architecture.</li>
</ul>
<p>If, however, same application is built on different board (but having same processor architecture), it will result same area id and otap mechanism cannot disinguish the images from others.</p>
<dl class="section note"><dt>Note</dt><dd>It is up to each customer to maintain its own set of <code>app_area_id</code> to avoid mismatch between its applications.</dd></dl>
<h3><a class="anchor" id="app_version"></a>
Application version</h3>
<p>Following definitions:</p>
<div class="fragment"><div class="line"><span class="preprocessor"># App version</span></div><div class="line">app_major=1</div><div class="line">app_minor=0</div><div class="line">app_maintenance=0</div><div class="line">app_development=0</div></div><!-- fragment --><p>define the version of the application software. It is different from stack software and is application- specific. This information can be used to pinpoint which version of the application is running on the device.</p>
<h3><a class="anchor" id="app_target_boards"></a>
TARGET_BOARDS</h3>
<p>This configuration defines the <a class="el" href="../../d3/d03/sdk_file_structure.html#board_folder">boards</a> which application supports. Configuration is optional.</p>
<dl class="section note"><dt>Note</dt><dd>If configuration is not present, it equals that it is supported on <em>every</em> board available. Usually that is not the case so it is better to ensure that only boards supported are listed here. Then, if incorrect board is tried to be compiled, it is ensured that compilation fails.</dd></dl>
<p>Example: </p><div class="fragment"><div class="line">TARGET_BOARDS := pca10056 pca10059 pca10040 wirepas_brd4254a silabs_brd4254a tbsense2 ublox_b204 promistel_rpi_hat</div></div><!-- fragment --><h2><a class="anchor" id="source_makefile"></a>
makefile</h2>
<p>Application specific makefile contains application-specific build recipes. Here, the common features are documented:</p>
<h3><a class="anchor" id="source_makefile_app_printing"></a>
APP_PRINTING</h3>
<p>Enabling of <a class="el" href="../../d9/d2a/uart__print_8h.html">uart_print.h</a> app debug prints can be done with this configuration.</p>
<p>Example: </p><div class="fragment"><div class="line"><span class="preprocessor"># Enable application debug prints</span></div><div class="line"><span class="preprocessor">APP_PRINTING=yes</span></div></div><!-- fragment --><h3><a class="anchor" id="source_makefile_app_scheduler"></a>
APP_SCHEDULER</h3>
<p>Using of <a class="el" href="../../dd/ddc/app__scheduler_8h.html">app scheduler</a> can be done by using this flag.</p>
<dl class="section note"><dt>Note</dt><dd>You also need to enable two compilation flags by using <a class="el" href="../../d3/d03/sdk_file_structure.html#source_makefile_cflags">CFLAGS</a> option</dd></dl>
<p>Example: </p><div class="fragment"><div class="line"><span class="preprocessor"># Use App Scheduler. Declare 4 tasks with maximum execution time of 100 us each</span></div><div class="line">APP_SCHEDULER=yes</div><div class="line">CFLAGS += -DAPP_SCHEDULER_MAX_TASKS=4</div><div class="line">CFLAGS += -DAPP_SCHEDULER_MAX_EXEC_TIME_US=100</div></div><!-- fragment --><h3><a class="anchor" id="source_makefile_cflags"></a>
CFLAGS</h3>
<p>Introducing custom compilation flags for compilation can be done by extending this list.</p>
<p>Example: </p><div class="fragment"><div class="line">CFLAGS += -DOWN_FLAG</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Commonly this is used in many applications to propagate network address and network channel defined in <a class="el" href="../../d6/d6f/config_8mk.html">config.mk</a> file to compilation flags: <div class="fragment"><div class="line"><span class="preprocessor"># Define default network settings</span></div><div class="line">CFLAGS += -DNETWORK_ADDRESS=$(default_network_address)</div><div class="line">CFLAGS += -DNETWORK_CHANNEL=$(default_network_channel)</div></div><!-- fragment --></dd></dl>
<h3><a class="anchor" id="source_makefile_hal_button"></a>
HAL_BUTTON</h3>
<p>Using of <a class="el" href="../../d7/d0e/button_8h.html">HAL for buttons</a> can be done by this flag.</p>
<p>Example: </p><div class="fragment"><div class="line"><span class="preprocessor"># This application use HAL for buttons</span></div><div class="line"><span class="preprocessor">HAL_BUTTON=yes</span></div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>: in order for application to be able to drive buttons, they must be defined in specific <a class="el" href="../../d3/d03/sdk_file_structure.html#board_folder">board</a>. </dd>
<dd>
This option is supported only on nRF52 architectures.</dd></dl>
<h3><a class="anchor" id="source_makefile_hal_hw_delay"></a>
HAL_HW_DELAY</h3>
<p>Using of <a class="el" href="../../d2/d4c/hw__delay_8h.html">HAL for hardware delay</a> can be done by this flag.</p>
<p>Example: </p><div class="fragment"><div class="line">HAL_HW_DELAY=yes</div></div><!-- fragment --><h3><a class="anchor" id="source_makefile_hal_i2c"></a>
HAL_I2C</h3>
<p>Using of <a class="el" href="../../d5/daf/i2c_8h.html">HAL for I2C interface</a> can be done by this flag.</p>
<p>Example: </p><div class="fragment"><div class="line">HAL_I2C=yes</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>This option is supported only on nRF52 architectures.</dd></dl>
<h3><a class="anchor" id="source_makefile_hal_led"></a>
HAL_LED</h3>
<p>Using of <a class="el" href="../../db/da0/led_8h.html">HAL for led driving</a> can be done by this flag.</p>
<p>Example: </p><div class="fragment"><div class="line"><span class="preprocessor"># This application use HAL for leds</span></div><div class="line"><span class="preprocessor">HAL_LED=yes</span></div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>: in order for application to be able to drive LEDs, they must be defined in specific <a class="el" href="../../d3/d03/sdk_file_structure.html#board_folder">board</a>.</dd></dl>
<h3><a class="anchor" id="source_makefile_hal_persistent_memory"></a>
HAL_PERSISTENT_MEMORY</h3>
<p>Using of <a class="el" href="../../de/de8/persistent_8h.html">HAL for persistent memory</a> can be done by this flag.</p>
<dl class="section note"><dt>Note</dt><dd>You need to define <code>-DUSE_PERSISTENT_MEMORY</code> by using <a class="el" href="../../d3/d03/sdk_file_structure.html#source_makefile_cflags">CLAGS</a> option.</dd></dl>
<p>Example: </p><div class="fragment"><div class="line"><span class="preprocessor"># Use persistent memeory</span></div><div class="line">HAL_PERSISTENT_MEMORY=yes</div><div class="line">CFLAGS += -DUSE_PERSISTENT_MEMORY</div></div><!-- fragment --><h3><a class="anchor" id="source_makefile_hal_spi"></a>
HAL_SPI</h3>
<p>Using of <a class="el" href="../../da/d87/spi_8h.html">HAL for SPI interface</a> can be done by this flag.</p>
<p>Example: </p><div class="fragment"><div class="line">HAL_SPI=yes</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>This option is supported only on nRF52 architectures.</dd></dl>
<h3><a class="anchor" id="source_makefile_hal_uart"></a>
HAL_UART</h3>
<p>Using of <a class="el" href="../../d3/dfa/mcu_2hal__api_2usart_8h.html">HAL for UART interface</a> can be done by this flag.</p>
<p>Example: </p><div class="fragment"><div class="line">HAL_UART=yes</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>: in order for application to be able to UART, they must be defined in specific <a class="el" href="../../d3/d03/sdk_file_structure.html#board_folder">board</a>.</dd></dl>
<p>There is also related flag <code>UART_USE_DMA</code> that can be used to enable DMA functionality.</p>
<p>Example: </p><div class="fragment"><div class="line">HAL_UART=yes</div><div class="line">UART_USE_DMA=yes</div></div><!-- fragment --><h3><a class="anchor" id="source_makefile_includes"></a>
INCLUDES</h3>
<p>Extending to to include folders for include search paths can be done by extending this list.</p>
<p>Example: </p><div class="fragment"><div class="line">INCLUDES +=</div></div><!-- fragment --><h3><a class="anchor" id="source_makefile_ldflags"></a>
LDFLAGS</h3>
<p>Introducing custom linker flags for ld can be done by extending this list.</p>
<p>Example: </p><div class="fragment"><div class="line"><span class="preprocessor">#Link standard C math library</span></div><div class="line"><span class="preprocessor">LDFLAGS += -lm</span></div></div><!-- fragment --><h3><a class="anchor" id="source_makefile_libs"></a>
LIBS</h3>
<p>Introducing of precompiled libraries (.a files) for compilation can be done by extending this list.</p>
<p>Example: </p><div class="fragment"><div class="line">LIBS +=</div></div><!-- fragment --><h3><a class="anchor" id="source_makefile_shared_libdata"></a>
SHARED_LIBDATA</h3>
<p>Using of <a class="el" href="../../d4/dfa/shared__libdata_8h.html">shared libdata library</a> can be done by using this flag.</p>
<p>Example: </p><div class="fragment"><div class="line"><span class="preprocessor"># Use Shared LibData</span></div><div class="line"><span class="preprocessor">SHARED_LIBDATA=yes</span></div></div><!-- fragment --><h3><a class="anchor" id="source_makefile_srcs"></a>
SRCS</h3>
<p>Introducing of new source files can be done by extending this list.</p>
<p>Example: </p><div class="fragment"><div class="line">SRCS +=</div></div><!-- fragment --><h3><a class="anchor" id="source_makefile_sw_aes"></a>
SW_AES</h3>
<p><a class="el" href="../../db/dcb/aes_8h.html">Software AES library</a> can be enabled by using this configuration.</p>
<p>Example: </p><div class="fragment"><div class="line"><span class="preprocessor"># Enable software AES</span></div><div class="line"><span class="preprocessor">SW_AES=yes</span></div></div><!-- fragment --><h1><a class="anchor" id="tools_folder"></a>
tools/ Various tools used in build process</h1>
<p>This folder contains various tools, mainly implemented in Python, used during build process of the application.</p>
<h2><a class="anchor" id="genscratchpad_py"></a>
genscratchpad.py</h2>
<p>This tool, used by the <a class="el" href="../../d3/d03/sdk_file_structure.html#makefile">Makefile</a>, allows the scratchpad binary generation for the OTAP update. It uses the <code>ini</code> file in the same directory</p>
<h2><a class="anchor" id="config_mk_ini_file"></a>
INI_FILE</h2>
<p>All scratchpad images received <em>Over The Air</em> are compressed and encrypted.</p>
<p>The bootloader authenticates the image and decrypts it, so authentication and encryption keys used to generate a scratchpad must match the ones stored in the bootloader.</p>
<p>The list of keys stored in bootloader can be configured at the end of <code>tools/scratchpad_&lt;mcu&gt;.ini</code> file. The bootloader can contain several keys and will decrypt a received scratchpad, if it can be authenticated with any of the listed keys.</p>
<p>By default, each application uses the same <code>.ini</code> file stored in <code>tools/scratchpad_&lt;mcu&gt;.ini</code> but it can be copied to the application folder and modified as needed. The new <code>.ini</code> file can be specified from the application as following:</p>
<div class="fragment"><div class="line"><span class="preprocessor"># Define a specific scratchpad ini</span></div><div class="line"><span class="preprocessor">INI_FILE = $(APP_SRCS_PATH)/scratchpad_custom.ini</span></div></div><!-- fragment --><p>The scratchpad generated from an application build use the key named <code>default</code> from the <code>.ini</code> file. It can be changed by adding the <code>&ndash;keyname</code> option to the invocation of <code>genscratchpad.py</code> script from makefile.</p>
<dl class="section note"><dt>Note</dt><dd>All released SDK have the same default keys (known by all users), so these keys cannot be considered secure.</dd>
<dd>
It is highly recommended to modify these keys before any deployment, to reduce the risk of malicious network access.</dd></dl>
<h1><a class="anchor" id="util_folder"></a>
utils/ Utility and helper services</h1>
<p>Thirs group of services is utility and helper functions. They are various, hardware-independent, functions solely to ease the implementation. They are located in <a class="el" href="../../dir_23ec12649285f9fabf3a6b7380226c28.html">util</a> folder.</p>
<table class="doxtable">
<tr>
<th>Name</th><th>Description </th></tr>
<tr>
<td><a class="el" href="../../dc/d65/api_8h.html">api.h</a></td><td>Global API for Wirepas library services </td></tr>
<tr>
<td><a class="el" href="../../dc/de6/crc_8h.html">crc.h</a></td><td>Implementation of <a href="http://srecord.sourceforge.net/crc16-ccitt.html">"bad CRC-16 CCITT"</a> algorithm </td></tr>
<tr>
<td><a class="el" href="../../d7/df6/doublebuffer_8h.html">doublebuffer.h</a></td><td>Managing of double buffering </td></tr>
<tr>
<td><a class="el" href="../../df/d2e/node__configuration_8h.html">node_configuration.h</a></td><td>Helper function to initially setup a node if not already configured. This configuration can be modified later with remote API. </td></tr>
<tr>
<td><a class="el" href="../../d5/dcb/pack_8h.html">pack.h</a></td><td>Little Endian bytes to native integers packing and unpacking </td></tr>
<tr>
<td><a class="el" href="../../d1/d79/random_8h.html">random.h</a></td><td>Random number generator </td></tr>
<tr>
<td><a class="el" href="../../d6/da4/ringbuffer_8h.html">ringbuffer.h</a></td><td>Ring buffers </td></tr>
<tr>
<td><a class="el" href="../../da/dc2/sl__list_8h.html">sl_list.h</a></td><td>Single Linked List </td></tr>
<tr>
<td><a class="el" href="../../d7/dc3/tlv_8h.html">tlv.h</a></td><td>Encoding/decoding of TLV (Type Length Value) format </td></tr>
<tr>
<td><a class="el" href="../../d8/d3c/util_8h.html">util.h</a></td><td>Miscellaneous helper functions </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Apr 29 2020 14:18:53 for Wirepas Single-MCU SDK by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
